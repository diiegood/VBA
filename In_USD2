Sub SOI_USD()

    Dim wsOrigen As Worksheet
    Dim wsDestino As Worksheet
    Dim ultimaFila As Long
    Dim i As Long, filaDestino As Long
    Dim SSItext As String
    Dim tipoOp As String
    Dim contraparte As String
    
    
'##################################################################################################
    
    'Asignacion de Hojas
    Set wsOrigen = ThisWorkbook.Sheets("Reporte Garantias") 'hoja que va extraer los datos
    Set wsDestino = ActiveSheet   'hoja donde se va trabajar
    
    'Ultima fila con datos en hoja origen
    ultimaFila = wsOrigen.Cells(wsOrigen.Rows.Count, "A").End(xlUp).Row
    
    'Limpiar rango destino en hoja origen
    With wsDestino.Range("A21:D29")
        .ClearContents
        .Borders.LineStyle = xlNone
    End With
    
    filaDestino = 21
    
    'Procesamiento de salidas
    For i = 2 To ultimaFila
        If Trim(UCase(wsOrigen.Cells(i, "H").Value)) = "USD" Then
            tipoOp = UCase(Trim(wsOrigen.Cells(i, "D").Value))
            If tipoOp = "SALIDA" Then
            
            'Obtener contrapartes y remplazar los codigos por nombres
            contraparte = wsOrigen.Cells(i, "C").Value
            Select Case UCase(Trim(contraparte))
                Case "BBVI"
                    contraparte = "BBVA BANCOMER, S.A."
                Case "CHMX"
                    contraparte = "BANCO J.P. MORGAN S.A."
                Case "CITIMEX"
                    contraparte = "BANCO CITI MÉXICO S.A. INSTITUCIÓN DE BANCA MÚLTIPLE, GRUPO FINANCIERO CITI MÉXICO"
                Case "BSAN"
                    contraparte = "BANCO SANTANDER, S.A. INSTITUCION DE BANCA MULTIPLE GRUPO FINANCIERO SANTANDER"
                Case "CBGSMX"
                    contraparte = "GOLDMAN SACHS MEXICO CASA DE BOLSA"
                Case "BNP PARIS"
                    contraparte = "BNP PARIBAS"
                Case "BBMX"
                    contraparte = "BARCLAYS BANK MEXICO, S.A., INSTITUCION DE BANCA MULTIPLE, GRUPO FINANCIERO BARCLAYS MEXICO."
                Case "RBMX"
                    contraparte = "HSBC MEXICO, S.A. INSTITUCION DE BANCA MULTIPLE"
            End Select
            
            
            'Concatenar texto SSI
            SSItext = ""
            If wsOrigen.Cells(i, "M").Value <> "" Then SSItext = SSItext & "Bic corresponsal: " & wsOrigen.Cells(i, "M").Value & vbNewLine
            If wsOrigen.Cells(i, "M").Value <> "" Then SSItext = SSItext & "Banco corresponsal: " & wsOrigen.Cells(i, "N").Value & vbNewLine
            If wsOrigen.Cells(i, "M").Value <> "" Then SSItext = SSItext & "BIC corresponsal: " & wsOrigen.Cells(i, "P").Value & vbNewLine
            If wsOrigen.Cells(i, "M").Value <> "" Then SSItext = SSItext & "Cuenta Beneficiario: " & wsOrigen.Cells(i, "Q").Value
            
            
            'Pegar la salida
            wsDestino.Cells(filaDestino, "A").Value = contraparte
            wsDestino.Cells(filaDestino, "A").WrapText = False
            wsDestino.Cells(filaDestino, "B").ClearContents
            wsDestino.Cells(filaDestino, "C").Value = wsOrigen.Cells(i, "F").Value
            wsDestino.Cells(filaDestino, "D").Value = SSItext
            wsDestino.Cells(filaDestino, "D").WrapText = True
            
            filaDestino = filaDestino + 1
            If filaDestino > 29 Then Exit For
        End If
    End If
 Next i
 
'#################################################################################################
 
     'Formato de las celdas que se van a capturar
    With wsDestino.Range("A21:D29")
         .Font.Name = "Arial"
         .Font.Size = "10"
         .VerticalAlignment = xlCenter
    End With
     
     'Formato contabilidad y centrado de importe
    With wsDestino.Range("B21:C29")
         .NumberFormat = "_($* #,##0.00_);_($* (#,##0.00);_($* ""-""??_);_(@_)"
         .HorizontalAlignment = xlCenter
         
    End With
     
    'Ajustar ancho de los nombres
    'wsDestino.Columns("A").AutoFit
    wsDestino.Columns("D").AutoFit
     
     
    'Ajustar altura de las filas SSI
    wsDestino.Rows("21:29").AutoFit
        
    MsgBox "Proceso completado SOI USD"
    

    ' AjusteColumna Macro
    ActiveWindow.SmallScroll Down:=14
    Range("A21:A28").Select
    With Selection
        .HorizontalAlignment = xlGeneral
        .VerticalAlignment = xlCenter
        .WrapText = True
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With
    ActiveWindow.SmallScroll Down:=15
    Range("A29").Select
    ActiveWindow.SmallScroll Down:=-15
    
' Diseño_mejorado Macro


    Range("A21:A28").Select
    ActiveWindow.SmallScroll Down:=-10
    With Selection
        .HorizontalAlignment = xlGeneral
        .VerticalAlignment = xlCenter
        .WrapText = True
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With
    ActiveWindow.SmallScroll Down:=-3
    Range("A19:D20").Select
    Range("D19").Activate
    Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    With Selection.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    With Selection.Borders(xlInsideVertical)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideHorizontal)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    Range("D19:D20").Select
    Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    With Selection.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    Selection.Borders(xlInsideVertical).LineStyle = xlNone
    With Selection.Borders(xlInsideHorizontal)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    With Selection.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    Selection.Borders(xlInsideVertical).LineStyle = xlNone
    With Selection.Borders(xlInsideHorizontal)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    Range("B20").Select
    Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    With Selection.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    Selection.Borders(xlInsideVertical).LineStyle = xlNone
    Selection.Borders(xlInsideHorizontal).LineStyle = xlNone
    Range("C20").Select
    Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    With Selection.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    Selection.Borders(xlInsideVertical).LineStyle = xlNone
    Selection.Borders(xlInsideHorizontal).LineStyle = xlNone
    Range("B19:C19").Select
    Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    With Selection.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    With Selection.Borders(xlInsideVertical)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    Selection.Borders(xlInsideHorizontal).LineStyle = xlNone
    Range("A19:A20").Select
    Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    With Selection.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    Selection.Borders(xlInsideVertical).LineStyle = xlNone
    With Selection.Borders(xlInsideHorizontal)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    Range("D19:D20").Select
    ActiveWindow.SmallScroll Down:=-3
    Range("E16").Select
    
End Sub

    
        
        
        
        
        
        
